const URL={AUDIO_STREAM:"https://swapetown.xyz/radio/8000/stream",PLAYIN_NOW:"wss://swapetown.xyz/api/live/nowplaying/tapetown",PLAYING_LIVE:"assets/js/data.json"};class Donation{constructor(){this.cash=document.getElementById("cash"),this.payButton=document.getElementById("paybtn"),this.openPopUp=document.querySelector("[data-popup-open]"),this.closePopUp=document.querySelector("[data-popup-close]"),this.mount()}mount(){this.payButton.addEventListener("click",()=>{this.cash.play()}),this.initOpenPopUp(),this.initClosePopUp()}initOpenPopUp(){this.openPopUp.addEventListener("click",()=>{$('[data-popup="'+this.openPopUp.getAttribute("data-popup-open")+'"]').fadeIn(350)})}initClosePopUp(){this.closePopUp.addEventListener("click",()=>{$('[data-popup="'+this.closePopUp.getAttribute("data-popup-close")+'"]').fadeOut(350)})}}class Layout{constructor(){this.backgrounds=["background9.png"],this.darkBackground=$("#p_prldr"),this.animation=this.darkBackground.find(".svg_anm"),this.hidePreloader=this.hidePreloader.bind(this),window.addEventListener("load",this.hidePreloader),this.setBackgroundImage()}static DARK_BACKGROUND_DURATION=1e3;static ANIMATION_DURATION=1500;hidePreloader(){this.animation.delay(Layout.DARK_BACKGROUND_DURATION).fadeOut(),this.darkBackground.delay(Layout.ANIMATION_DURATION).fadeOut("slow"),this.removeDarkBackground()}removeDarkBackground(){document.body.classList.remove("js-loading")}setBackgroundImage(){document.querySelector("body").style.backgroundImage=this.getBackgroundLink()}getBackgroundLink(){return`url(assets/img/${this.getRandomBackground()}`}getRandomBackground(){return this.backgrounds[Math.floor(Math.random()*this.backgrounds.length)]}}class Rest{getNowPlaying(){return new WebSocket(URL.PLAYIN_NOW)}getNowPlayingFromJson(){return this.extractData(fetch(URL.PLAYING_LIVE)).then(({now_playing:t})=>t)}getNextLive(){return this.extractData(fetch(URL.PLAYING_LIVE)).then(({upcoming:t})=>t)}extractData(t){return t.then(t=>t.json()).then(({data:t})=>t)}}class Tabs{constructor(){this.tabs=Array.from(document.getElementsByClassName("menu-items")),this.content=Array.from(document.getElementsByClassName("menu-item-content")),this.switchTab=this.switchTab.bind(this),this.tabs.forEach((t,e)=>{t.addEventListener("click",this.switchTab(t,e))})}switchTab(t,e){return()=>{this.setUnactive(),t.classList.add("active"),this.setContent(e)}}setUnactive(){this.tabs.forEach(t=>{t.classList.contains("active")&&t.classList.remove("active")})}setContent(t){this.content.forEach(t=>{"block"===t.style.display&&(t.style.display="none")}),this.content[t].style.display="block"}}class PlayerController{constructor(t,e){this.view=t,this.rest=e,this.setPlayerState=this.setPlayerState.bind(this),this.view.playButton.addEventListener("click",this.setPlayerState),this.view.setAudioSource(URL.AUDIO_STREAM),this.setVolumeSlider(),this.setNowPlaying(),this.setNextLive()}setPlayerState(){this.view.getAudioState()?this.view.play():this.view.pause(),this.view.setButtonState()}setVolumeSlider(){this.view.slider.addEventListener("input",t=>{this.view.setVolume(t.target.value)})}setNowPlaying(){this.rest.getNowPlaying().addEventListener("message",async t=>{this.view.setNowText(await this.defineWhatPlaying(JSON.parse(t.data)))})}setNextLive(){this.rest.getNextLive().then(t=>{this.view.setTbaText(t)})}defineWhatPlaying(t){var{live:{is_live:e}}=t;return e?(this.view.setFlash(),this.rest.getNowPlayingFromJson()):Promise.resolve(t?.now_playing?.song?.text)}}class PlayerView{constructor(){this.audio=document.getElementById("myTune"),this.playButton=document.getElementById("btn"),this.slider=document.querySelector(".volume-bar"),this.flash=document.querySelector(".flash"),this.now=document.getElementById("now1"),this.tba=document.getElementById("tba")}setAudioSource(t){const e=document.createElement("source");e.setAttribute("src",t),e.setAttribute("type","audio/mpeg"),this.audio.appendChild(e)}getAudioState(){return this.audio.paused}play(){this.audio.play()}pause(){this.audio.pause()}setVolume(t){this.audio.volume=parseInt(t,10)/100}setNowText(t){this.now.textContent=t}setTbaText(t){this.tba.textContent=t}setFlash(){this.flash.style.display="block"}setButtonState(){this.audio.paused?(this.playButton.classList.remove("fa","fa-pause"),this.playButton.classList.add("fa","fa-play")):(this.playButton.classList.remove("fa","fa-play"),this.playButton.classList.add("fa","fa-pause"))}}new Layout,new Tabs,new PlayerController(new PlayerView,new Rest),new Donation,$("iframe.yt-hd-thumbnail").youTubeHDThumbnail({darkenThumbnail:!1});